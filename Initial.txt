##########SUNSHINE SETUP###################
Start-Process -FilePath "$env:USERPROFILE\Downloads\Sunshine-Windows-AMD64-installer.exe"-ArgumentList "/S" -Wait -NoNewWindow

sc.exe create sunshine binPath= "C:\Program Files\Sunshine\sunshine.exe\" start= auto DisplayName= "Sunshine"


Start-Process -FilePath "${env:ProgramFiles}\Sunshine\sunshine.exe" -WorkingDirectory "C:\Program Files\Sunshine"  -Verb RunAs -WindowStyle Hidden

cd 'C:\Program Files\Sunshine\'
.\sunshine.exe --creds bluefml1 letmeinpls
Stop-Process -Name sunshine -Force

Start-Process -FilePath "${env:ProgramFiles}\Sunshine\sunshine.exe" -WorkingDirectory "C:\Program Files\Sunshine"  -Verb RunAs -WindowStyle Hidden



##########Moonlight WEb set up############
Invoke-WebRequest "https://github.com/MrCreativ3001/moonlight-web-stream/releases/download/v1.6/moonlight-web-x86_64-pc-windows-gnu.zip" -OutFile "$env:USERPROFILE\Downloads\moonlight-web-x86_64-pc-windows-gnu.zip" -UseBasicParsing

Expand-Archive -Path "$env:USERPROFILE\Downloads\moonlight-web-x86_64-pc-windows-gnu.zip" -DestinationPath "$env:USERPROFILE\Downloads\moonlight-web" -Force

New-Item -Path "$env:USERPROFILE\Downloads\moonlight-web\server" -ItemType Directory -Force | Out-Null
Invoke-WebRequest "https://raw.githubusercontent.com/bluefml1/bongsenvang-assets/main/config.json" -OutFile "$env:USERPROFILE\Downloads\moonlight-web\server\config.json" -UseBasicParsing

Start-Process -FilePath "$env:USERPROFILE\Downloads\moonlight-web\web-server.exe" -WorkingDirectory "$env:USERPROFILE\Downloads\moonlight-web\"  -WindowStyle Hidden


curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/cfd_tunnel" \
  --request POST \
  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \
  --json '{
    "name": "api-tunnel",
    "config_src": "cloudflare"
  }'

curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/cfd_tunnel/$TUNNEL_ID/configurations" \
  --request PUT \
  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \
  --json '{
    "config": {
        "ingress": [
            {
                "hostname": "app.example.com",
                "service": "http://localhost:8001",
                "originRequest": {}
            },
            {
                "service": "http_status:404"
            }
        ]
    }
  }'

curl "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records" \
  --request POST \
  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \
  --json '{
    "type": "CNAME",
    "proxied": true,
    "name": "app.example.com",
    "content": "c1744f8b-faa1-48a4-9e5c-02ac921467fa.cfargotunnel.com"
  }'
